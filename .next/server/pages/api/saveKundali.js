"use strict";(()=>{var e={};e.id=162,e.ids=[162],e.modules={3480:(e,t,a)=>{e.exports=a(5600)},3873:e=>{e.exports=require("path")},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},6555:(e,t,a)=>{a.r(t),a.d(t,{config:()=>y,default:()=>A,routeModule:()=>v});var n={};a.r(n),a.d(n,{default:()=>P});var r=a(3480),s=a(8667),o=a(6435),i=a(9021),u=a.n(i),l=a(3873),d=a.n(l);let c=require("moment-timezone");var p=a.n(c);let f=require("tz-lookup");var m=a.n(f);let h=process.env.FREE_ASTROLOGY_API_KEY,g=(e,t,a)=>{let n=m()(e,t);return p().tz(a,n).utcOffset()/60};async function P(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});console.log("Received request to save Kundali data"),console.log("Request body:",e.body);let{name:a,dateOfBirth:n,timeOfBirth:r,placeOfBirth:s,latitude:o,longitude:i,timezone:l}=e.body;if(!a||!n||!r||!s||!o||!i)return t.status(400).json({message:"Missing required fields"});let[c,p,f]=n.split("-").map(Number),[m,P]=r.split(":").map(Number),A=g(o,i,`${n}T${r}:00`),y={year:c,month:p,date:f,hours:m,minutes:P,seconds:0,latitude:o,longitude:i,timezone:A,observation_point:"topocentric",ayanamsha:"lahiri",language:"en"},v={};try{for(let{key:e,path:t}of[{key:"planetsExtended",path:"planets/extended"},{key:"mahadashaAntardasha",path:"vimsottari/maha-dasas-and-antar-dasas"}]){let a=await fetch(`https://json.apiastro.com/${t}`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":h},body:JSON.stringify(y)});if(console.log(`Fetching ${e}: ${a.status} ${a.statusText}`),!a.ok){let t=await a.text();throw console.error(`Error fetching ${e}:`,t),Error(`Failed to fetch ${e}: ${t}`)}let n=await a.json();v[e]=n}let e={name:a,dateOfBirth:n,timeOfBirth:r,placeOfBirth:s,latitude:o,longitude:i,timezone:A,generatedAt:new Date().toISOString(),data:v},l=d().join(process.cwd(),"public",`${a.replace(/\s+/g,"_")}_kundali.json`);return u().writeFileSync(l,JSON.stringify(e,null,2)),t.status(200).json({message:"Kundali fetched and saved successfully",filePath:`/public/${a.replace(/\s+/g,"_")}_kundali.json`,kundaliData:e})}catch(e){return console.error("Error fetching kundali data:",e),t.status(500).json({message:e.message||"Failed to fetch kundali data"})}}let A=(0,o.M)(n,"default"),y=(0,o.M)(n,"config"),v=new r.PagesAPIRouteModule({definition:{kind:s.A.PAGES_API,page:"/api/saveKundali",pathname:"/api/saveKundali",bundlePath:"",filename:""},userland:n})},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return a}});var a=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},9021:e=>{e.exports=require("fs")}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=t(t.s=6555);module.exports=a})();